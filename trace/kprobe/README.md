## Example Introduction
### 1. Overview
This program demonstrates attaching an eBPF program to a kernel symbol. The eBPF program will be attached to the start of the sys_execve kernel function and prints out the number of times it has been called every second.

### 2. Include Files
- kprobe_kern.c
  - The ebpf codes injected to kernel
- kprobe_user.go
  - The golang software based on `github.com/cilium/ebpf` running in user space
- exampleKprobe_bpfel_x86.go and exampleKprobe_bpfel_x86.o
  - Both files are generated by `github.com/cilium/ebpf/cmd/bpf2go`
  - You can generate those files by command `go generate` under this folder

### 3. Kernel Space Code
- Define a bpf_map which is used for communication between kernel space and user space
- Define a function which can be attached to ebpf hooks. When the function is invoked, the counter in bpf_map increase
- `//go:build ignore` is the `build constraints` in golang. It indicates this file should be included in golang compile
- `// +build ignore` is same as `//go:build ignore`. From golang 1.17ï¼Œ`build constraints` change from `// +build` to `//go:build`, they can be used together for compatibility currently
- Jetbrain goland support `//go:build` from version 2021.2
- `SEC("kprobe/sys_execve")` is something like namespace, it can be named as you want
- `int kprobe_execve()` define a function which can be attached, it can be named as you want

### 4. User Space Code
- `//go:build linux` and `// +build linux` is the golang `build constraints`
- `//go:generate go run github.com/cilium/ebpf/cmd/bpf2go -target amd64 -cc clang-10 exampleKprobe ./kprobe_kern.c -- -nostdinc -Wall -Werror -I../../include -I../../libbpf/src`
  - `go:generate` define what actions to do when execute command `go generate` in this folder
  - Here we use `github.com/cilium/ebpf/cmd/bpf2go` to generate `exampleKprobe_bpfel_x86.go` and `exampleKprobe_bpfel_x86.o`
  - Without `-target amd64`, `bpf2go` will generate 2 types of golang file named `xxx_bpfel.go` and `xxx_bpfeb.go`. The two files contain compiled BPF for little and big endian systems, respectively.
  - With `-target amd64`, only `xxx_bpfel.go` will be generated because amd64 is little endian systems
  - `-cc clang-10` is installed clang in your system
  - `exampleKprobe` is the prefix for generated files and Go types/functions. It should be a valid Go identifier
  - `-I../../include -I../../libbpf/src` is the ebpf dependency path include `vmlinux.h` and `libbpf`

### 5. Run This Example
- Generate Codes
```
rm examplekprobe_bpfel_x86.go examplekprobe_bpfel_x86.o
go generate
```
- Build User Space Bin
```
go build
```
- Run Program
```
sudo ./kprobe
```
